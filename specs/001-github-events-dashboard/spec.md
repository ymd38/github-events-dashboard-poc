# Feature Specification: GitHub Events Dashboard

**Feature Branch**: `001-github-events-dashboard`  
**Created**: 2026-02-15  
**Status**: Clarified  
**Input**: User description: "GitHubリポジトリのイベント（Issue作成/PRマージなど）をWebhookで受け取り、Web UIでリアルタイム通知/ログ表示するサービス"

## Clarifications

### Session 2026-02-15

- Q: イベント一覧のページネーション方式は？ → A: ページネーション（ページ番号で切り替え、1ページあたり固定件数）
- Q: セッション有効期限切れ時のリアルタイム接続の挙動は？ → A: リアルタイム接続を即座に切断し、ログイン画面にリダイレクトする
- Q: GitHub OAuth認証失敗時のフォールバックは？ → A: エラーメッセージを表示し、再ログインを促す（リトライボタン付き）
- Q: 観測性（ログ・エラー追跡）の要件は？ → A: 構造化ログ + ヘルスチェックエンドポイント
- Q: リアルタイム接続切断中の未受信イベントの扱いは？ → A: 再接続時にAPIから最新イベントを再取得し一覧を更新する

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Webhookイベント受信と永続化 (Priority: P1)

GitHubリポジトリでIssueが作成またはPRがマージされると、システムがWebhookでイベントを受信し、署名検証を行った上でデータベースに保存する。これにより、すべてのイベントが一元的に記録される。

**Why this priority**: イベント受信と永続化はシステムの根幹機能であり、他のすべての機能（表示、リアルタイム通知等）がこの機能に依存する。これ単体でもイベントログとしての価値がある。

**Independent Test**: GitHub Webhookのテストペイロードを送信し、署名検証が通ったイベントのみがデータベースに保存されることを確認する。

**Acceptance Scenarios**:

1. **Given** システムが稼働中, **When** GitHubからIssue作成イベント（正当な署名付き）が送信される, **Then** イベントがデータベースに保存される
2. **Given** システムが稼働中, **When** GitHubからPRマージイベント（正当な署名付き）が送信される, **Then** イベントがデータベースに保存される
3. **Given** システムが稼働中, **When** 不正な署名を持つリクエストが送信される, **Then** リクエストが拒否されイベントは保存されない

---

### User Story 2 - ダッシュボードでイベント一覧を閲覧する (Priority: P2)

認証済みユーザーがダッシュボードにアクセスすると、過去に受信したイベントが新しい順に一覧表示される。各イベントにはイベント種別、リポジトリ名、操作者、発生日時が表示され、詳細を確認するとGitHubの該当ページへのリンクも閲覧できる。

**Why this priority**: 受信したイベントを人間が確認できるUIがなければ、システムの価値をユーザーに届けられない。P1のイベント受信と組み合わせることで最小限のMVPとなる。

**Independent Test**: テストデータをデータベースに投入し、ダッシュボードにログイン後、イベント一覧が正しく表示されることを確認する。

**Acceptance Scenarios**:

1. **Given** データベースにイベントが存在する, **When** 認証済みユーザーがダッシュボードにアクセスする, **Then** イベントが新しい順に一覧表示される
2. **Given** イベント一覧が表示されている, **When** ユーザーがイベントを選択する, **Then** イベント種別、リポジトリ名、操作者、発生日時、GitHub URLを含む詳細が表示される
3. **Given** イベント一覧が表示されている, **When** ユーザーがイベント種別フィルタを適用する, **Then** 選択した種別のイベントのみが表示される

---

### User Story 3 - リアルタイムでイベント通知を受け取る (Priority: P3)

ダッシュボードを開いているユーザーが、新しいイベントが発生した際にページリロードなしで自動的に画面が更新され、新着イベントが視覚的に区別できる形で表示される。

**Why this priority**: リアルタイム性はシステムの差別化要素であり、ユーザー体験を大幅に向上させる。ただしP1・P2が動作していれば手動リロードでも最低限の価値は提供できるため、P3とする。

**Independent Test**: ダッシュボードを開いた状態でWebhookテストペイロードを送信し、5秒以内にページリロードなしで新着イベントが表示されることを確認する。

**Acceptance Scenarios**:

1. **Given** ユーザーがダッシュボードを開いている, **When** 新しいイベントが受信される, **Then** 5秒以内にページリロードなしで新着イベントが画面上部に表示される
2. **Given** ユーザーがダッシュボードを開いている, **When** 新しいイベントが受信される, **Then** 新着イベントが視覚的にハイライトされる
3. **Given** ユーザーがフィルタを適用中, **When** フィルタに該当する新しいイベントが受信される, **Then** フィルタ結果にリアルタイムで反映される
4. **Given** ユーザーがフィルタを適用中, **When** フィルタに該当しない新しいイベントが受信される, **Then** フィルタ結果には表示されない

---

### User Story 4 - GitHub OAuthでログインする (Priority: P4)

ユーザーがGitHubアカウントを使ってダッシュボードにログインする。未認証ユーザーはダッシュボードにアクセスできず、ログイン画面にリダイレクトされる。ログアウト機能も提供する。

**Why this priority**: 認証はセキュリティ上重要だが、開発初期段階ではP1〜P3の機能検証を優先し、認証は後から統合可能。ただし一般公開を見据えて必須機能とする。

**Independent Test**: GitHub OAuthフローを通じてログインし、認証済み状態でダッシュボードにアクセスできること、未認証状態ではリダイレクトされることを確認する。

**Acceptance Scenarios**:

1. **Given** 未認証ユーザー, **When** ダッシュボードURLにアクセスする, **Then** ログイン画面にリダイレクトされる
2. **Given** ログイン画面が表示されている, **When** ユーザーがGitHubアカウントで認証する, **Then** ダッシュボードが表示される
3. **Given** 認証済みユーザー, **When** ログアウトを実行する, **Then** セッションが無効化されログイン画面にリダイレクトされる
4. **Given** セッション有効期限（24時間）が切れた, **When** ユーザーがダッシュボードにアクセスする, **Then** 再ログインが要求される
5. **Given** ログイン画面が表示されている, **When** GitHub OAuth認証が失敗する（GitHub障害・ユーザーが認可拒否等）, **Then** エラーメッセージとリトライボタンが表示される

---

### User Story 5 - コンテナ化された開発環境で起動する (Priority: P5)

開発者が単一コマンドで全サービス（フロントエンド、バックエンド、データベース）を起動し、ローカル環境で全機能を検証できる。

**Why this priority**: 開発環境の整備はすべての開発作業の前提条件だが、機能仕様としてはP1〜P4の後に位置づける。実際の開発順序ではインフラ整備が先行する。

**Independent Test**: 単一コマンドを実行し、全サービスが起動してヘルスチェックが通ることを確認する。

**Acceptance Scenarios**:

1. **Given** リポジトリをクローンし環境変数を設定済み, **When** 単一コマンドで起動する, **Then** フロントエンド、バックエンド、データベースの全サービスが起動する
2. **Given** 全サービスが起動している, **When** 各サービスのヘルスチェックを実行する, **Then** すべてが正常応答を返す

---

### Edge Cases

- 同一イベントがGitHubのリトライにより複数回送信された場合、重複保存されないこと（冪等性）
- リアルタイム接続が切断された場合、自動的に再接続を試みること
- データベースにイベントが0件の場合、空状態の適切なメッセージが表示されること
- 不正なペイロード形式（JSONパースエラー等）のリクエストが送信された場合、エラーとして処理されること
- セッション有効期限切れ時、リアルタイム接続を即座に切断しログイン画面にリダイレクトする
- リアルタイム接続が切断・再接続された場合、APIから最新イベントを再取得し切断中のイベントも表示する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはGitHubからのWebhookイベントを受信するエンドポイントを提供しなければならない
- **FR-002**: システムは受信時にWebhook署名（X-Hub-Signature-256）を検証し、不正なリクエストを拒否しなければならない
- **FR-003**: システムはIssue新規作成イベント（issues/opened）を処理できなければならない
- **FR-004**: システムはPRマージイベント（pull_request/closed, merged=true）を処理できなければならない
- **FR-005**: システムは検証済みイベントをデータベースに永続化しなければならない
- **FR-006**: システムはGitHub delivery IDによる重複排除（冪等性）を実装しなければならない
- **FR-007**: システムはイベントを新しい順にページネーション付きで一覧表示しなければならない（ページ番号切り替え、1ページあたり固定件数）
- **FR-008**: システムは各イベントのイベント種別、リポジトリ名、操作者、発生日時を一覧に表示しなければならない
- **FR-009**: システムはイベント種別によるフィルタリング機能を提供しなければならない
- **FR-010**: システムは各イベントの詳細情報（イベント固有データ、GitHub該当ページURL含む）を表示しなければならない
- **FR-011**: システムは新しいイベント受信時にページリロードなしでダッシュボードを自動更新しなければならない
- **FR-012**: システムはイベント発生から5秒以内にダッシュボードに反映しなければならない
- **FR-013**: システムは新着イベントを視覚的に区別できる表示（ハイライト等）を行わなければならない
- **FR-014**: システムはGitHub OAuthによるログイン認証を提供しなければならない
- **FR-015**: システムは未認証ユーザーのダッシュボードアクセスを拒否しなければならない
- **FR-016**: システムはログアウト機能を提供しなければならない
- **FR-017**: システムはセッション有効期限（24時間）を設け、期限切れ時に再ログインを要求しなければならない
- **FR-018**: システムはリアルタイム接続切断時に自動再接続を試みなければならない
- **FR-019**: システムは将来的に対象イベント種別を追加できる拡張性を持たなければならない
- **FR-020**: システムはイベント一覧のページ切り替え機能を提供し、ユーザーが任意のページへ移動できなければならない
- **FR-021**: システムはセッション有効期限切れ時にリアルタイム接続を即座に切断し、ログイン画面にリダイレクトしなければならない
- **FR-022**: システムはGitHub OAuth認証失敗時（GitHub障害・ユーザー認可拒否等）にエラーメッセージとリトライボタンを表示しなければならない
- **FR-023**: システムはリクエスト・エラー・イベント受信等の操作を構造化ログ（JSON形式）で出力しなければならない
- **FR-024**: システムはヘルスチェックエンドポイントを提供し、各サービスの稼働状況を確認できなければならない
- **FR-025**: システムはリアルタイム接続の再接続時にAPIから最新イベントを再取得し、切断中の未受信イベントも含めて一覧を更新しなければならない

### Key Entities *(include if feature involves data)*

- **Event（イベント）**: システムが受信・記録するGitHubリポジトリイベント。主要属性: 一意識別子、GitHub delivery ID、イベント種別（Issue/PR等）、アクション（opened/merged等）、リポジトリ名、操作者、発生日時、イベント固有データ（タイトル・本文等）、GitHub該当ページURL、受信日時
- **User（ユーザー）**: ダッシュボードにログインする開発チームメンバー。主要属性: 一意識別子、GitHubユーザー名、表示名、アバター画像URL、最終ログイン日時

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: GitHubリポジトリでIssueを作成すると、5秒以内にダッシュボードに表示される
- **SC-002**: GitHubリポジトリでPRをマージすると、5秒以内にダッシュボードに表示される
- **SC-003**: ダッシュボードを開いたまま、ページリロードなしで新着イベントが自動表示される
- **SC-004**: イベント種別でフィルタリングした結果が正しく表示される
- **SC-005**: 不正な署名を持つWebhookリクエストが100%拒否される
- **SC-006**: 未認証ユーザーがダッシュボードにアクセスした場合、100%ログイン画面にリダイレクトされる
- **SC-007**: ユーザーがGitHubアカウントでログインし、30秒以内にダッシュボードにアクセスできる
- **SC-008**: 単一コマンドで開発環境の全サービスが起動し、上記すべてが動作する
- **SC-009**: GitHubのWebhookリトライにより同一イベントが複数回送信されても、重複なく1件のみ保存される
- **SC-010**: 各サービスのヘルスチェックエンドポイントが正常応答を返し、稼働状況を確認できる

## Scope Boundaries

### In Scope

- Issue作成イベント（opened）の受信・表示
- PRマージイベント（closed, merged=true）の受信・表示
- Webhook署名検証（X-Hub-Signature-256）
- GitHub delivery IDによる重複排除
- GitHub OAuthによるログイン認証（セッション有効期限24時間）
- イベント一覧表示（新しい順）・イベント種別フィルタリング・イベント詳細表示
- リアルタイム更新（サーバープッシュ）・自動再接続
- イベントデータの永続化
- コンテナ化された開発環境（単一コマンドで全サービス起動）

### Out of Scope

- Issue closed/edited、PR opened/closed/review 等の追加イベント
- 複数リポジトリの管理UI
- イベントの検索・集計・統計ウィジェット
- メール・チャットツール等への外部通知連携
- CI/CDパイプライン
- 本番環境へのデプロイ・クラウドインフラ
- パフォーマンスチューニング・負荷テスト
- ユーザー権限管理（ロールベースアクセス制御）

## Dependencies & Assumptions

### Dependencies

- **GitHub Webhook**: GitHubがWebhookイベントを送信できること
- **GitHub OAuth App**: GitHub上でOAuthアプリケーションが登録されていること
- **ネットワーク**: ローカル環境からGitHub APIへのアクセスが可能であること（OAuth認証フロー用）
- **トンネリングツール**: ローカル環境でWebhookを受信するためにngrok等のツールが利用可能であること

### Assumptions

- 本システムは技術検証（PoC）を主目的とするが、一般公開可能な品質で構築する
- 初期スコープでは単一リポジトリからのイベントのみを対象とする
- ユーザー数は少数（開発チーム規模：〜10名程度）を想定する
- イベントデータの保持期間に制限は設けない（PoC期間中のデータ量は問題にならない想定）
- GitHub Webhookの再送機能（配信失敗時のリトライ）はGitHub側に依存し、本システムではdelivery IDによる冪等性で対応する
- セッション有効期限は24時間をデフォルトとする

## Risks

| リスク | 影響 | 軽減策 |
|--------|------|--------|
| ローカル環境でWebhookを受信できない | イベント受信のテストが困難 | ngrok等のトンネリングツールを利用してローカル環境を外部公開する |
| GitHub OAuthアプリの設定ミス | ログインが機能しない | 設定手順をドキュメント化し、環境変数で管理する |
| リアルタイム接続の切断 | 新着イベントが表示されない | 自動再接続機能を実装する |
| GitHub APIの仕様変更 | Webhookペイロードのパースが失敗する | GitHub APIバージョンを固定し、ペイロード検証を堅牢にする |

## Future Considerations

- 対象イベントの拡張（Issue closed/edited、PR opened/closed、Review、Push、Comment等）
- 複数リポジトリの同時監視
- イベントの検索・集計・統計ダッシュボード
- 外部通知連携（Slack、メール等）
- ユーザー権限管理（管理者/閲覧者等のロール）
- 本番環境へのデプロイ対応
