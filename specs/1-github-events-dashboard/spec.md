# Feature Specification: GitHub Events Dashboard

> **Feature ID**: 1-github-events-dashboard
> **Status**: Draft
> **Created**: 2026-02-15
> **Source**: [docs/first-requirement.md](../../docs/first-requirement.md)

---

## 1. Problem Statement

開発チームがGitHubリポジトリ上で発生するイベント（Issue作成、PRマージなど）をリアルタイムに把握する手段がない。各メンバーはGitHubの通知メールやWebサイトを個別に確認する必要があり、チーム全体でのイベント可視化・共有が困難である。

---

## 2. Goals & Objectives

- **リアルタイム可視化**: リポジトリイベントが発生した瞬間にダッシュボード上で確認できる
- **イベントログの一元管理**: 過去のイベントを時系列で閲覧・フィルタリングできる
- **セキュアなアクセス**: 認証されたユーザーのみがダッシュボードにアクセスできる
- **段階的拡張**: 最小限のイベントから開始し、将来的にイベント種別を拡張できる設計とする

---

## 3. Actors

| アクター | 説明 |
|----------|------|
| **ダッシュボードユーザー** | GitHubアカウントを持つ開発チームメンバー。ダッシュボードにログインしてイベントを閲覧する |
| **GitHub（外部システム）** | リポジトリ上でイベントが発生した際に、本システムへ自動通知を送信する |

---

## 4. User Scenarios & Testing

### Scenario 1: ログインしてダッシュボードを閲覧する

**前提条件**: ユーザーはGitHubアカウントを持っている

1. ユーザーがダッシュボードのURLにアクセスする
2. 未ログインの場合、ログイン画面が表示される
3. ユーザーがGitHubアカウントでログインする
4. ログイン成功後、イベント一覧画面（ダッシュボード）が表示される
5. 過去のイベントが新しい順に一覧表示されている

**受入条件**:
- 未認証ユーザーはダッシュボードにアクセスできない
- ログイン後、直近のイベントが一覧表示される
- 一覧にはイベント種別、リポジトリ名、操作者、発生日時が表示される

### Scenario 2: リアルタイムでイベント通知を受け取る

**前提条件**: ユーザーはダッシュボードにログイン済みで画面を開いている

1. 別のメンバーがGitHub上でIssueを新規作成する
2. ダッシュボードが自動的に更新され、新しいイベントが画面上部に表示される
3. ユーザーはページをリロードすることなく新しいイベントを確認できる

**受入条件**:
- イベント発生から5秒以内にダッシュボードに反映される
- ページリロードなしで新しいイベントが表示される
- 新着イベントが視覚的に区別できる（ハイライト等）

### Scenario 3: イベントをフィルタリングする

**前提条件**: ユーザーはダッシュボードにログイン済み

1. ユーザーがイベント種別のフィルタを選択する（例: "Issue作成" のみ）
2. 一覧が選択した種別のイベントのみに絞り込まれる
3. フィルタを解除すると全イベントが再表示される

**受入条件**:
- イベント種別でフィルタリングできる
- フィルタ適用中も新着イベントがリアルタイムで反映される（該当種別の場合）
- フィルタの切り替えが即座に反映される

### Scenario 4: イベントの詳細を確認する

**前提条件**: ユーザーはダッシュボードにログイン済み

1. ユーザーがイベント一覧から特定のイベントを選択する
2. イベントの詳細情報が表示される（イベント種別、リポジトリ名、操作者、発生日時、関連URL等）

**受入条件**:
- 各イベントの詳細情報が閲覧できる
- GitHubの該当ページへのリンクが含まれる

### Scenario 5: 不正なWebhookリクエストが拒否される

**前提条件**: システムが稼働中

1. 正しい署名を持たないリクエストがWebhookエンドポイントに送信される
2. システムがリクエストを拒否し、イベントとして記録しない

**受入条件**:
- 署名検証に失敗したリクエストは処理されない
- 正当なリクエストのみがイベントとして保存・配信される

---

## 5. Functional Requirements

### FR-1: イベント受信

- **FR-1.1**: システムはGitHubからのイベント通知を受信するエンドポイントを提供する
- **FR-1.2**: 受信時に送信元の正当性を署名検証により確認する
- **FR-1.3**: 検証に成功したイベントのみを永続化する
- **FR-1.4**: 受信したイベントをリアルタイムに接続中のクライアントへ配信する

### FR-2: 対象イベント（初期スコープ）

- **FR-2.1**: Issueの新規作成イベントを処理できる
- **FR-2.2**: Pull Requestのマージイベントを処理できる
- **FR-2.3**: 将来的に対象イベントを追加できる拡張性を持つ

### FR-3: ダッシュボード表示

- **FR-3.1**: イベントを新しい順に一覧表示する
- **FR-3.2**: 各イベントにはイベント種別、リポジトリ名、操作者、発生日時を表示する
- **FR-3.3**: イベント種別によるフィルタリング機能を提供する
- **FR-3.4**: 各イベントの詳細情報を閲覧できる
- **FR-3.5**: イベント詳細からGitHubの該当ページへ遷移できるリンクを提供する

### FR-4: リアルタイム更新

- **FR-4.1**: 新しいイベントが発生した際、ページリロードなしでダッシュボードを自動更新する
- **FR-4.2**: イベント発生から5秒以内にダッシュボードに反映する
- **FR-4.3**: 新着イベントを視覚的に区別できる表示を行う
- **FR-4.4**: フィルタ適用中も該当するイベントはリアルタイムで反映する

### FR-5: 認証・アクセス制御

- **FR-5.1**: GitHubアカウントによるログイン認証を提供する
- **FR-5.2**: 未認証ユーザーはダッシュボードにアクセスできない
- **FR-5.3**: ログアウト機能を提供する
- **FR-5.4**: セッションの有効期限を設け、期限切れ時は再ログインを要求する

### FR-6: イベントデータ永続化

- **FR-6.1**: 受信したイベントをデータベースに保存する
- **FR-6.2**: 保存するデータ: イベント種別、アクション、リポジトリ名、操作者、発生日時、イベント固有データ、GitHub該当ページURL
- **FR-6.3**: 保存されたイベントはダッシュボードから過去分も含めて閲覧できる

---

## 6. Non-Functional Requirements

| 項目 | 要件 |
|------|------|
| **可用性** | ローカル開発環境で安定して動作すること |
| **リアルタイム性** | イベント発生から表示まで5秒以内 |
| **セキュリティ** | Webhook署名検証、認証によるアクセス制御、秘匿情報の安全な管理 |
| **拡張性** | 新しいイベント種別の追加が既存機能に影響を与えない設計 |
| **開発環境** | 単一コマンドで全サービスが起動するコンテナ化された環境 |
| **コード品質** | 静的解析・リンター適用、単体テスト必須 |
| **ログ** | システムの動作状況を追跡可能な構造化ログ出力 |

---

## 7. Key Entities

### Event（イベント）

| 属性 | 説明 |
|------|------|
| ID | イベントの一意識別子 |
| イベント種別 | イベントのカテゴリ（Issue, Pull Request等） |
| アクション | 具体的な操作（opened, merged等） |
| リポジトリ名 | イベントが発生したリポジトリ |
| 操作者 | イベントを実行したGitHubユーザー |
| 発生日時 | イベントが発生した日時 |
| 詳細データ | イベント固有の追加情報（タイトル、本文等） |
| GitHub URL | GitHubの該当ページへのリンク |
| 受信日時 | システムがイベントを受信した日時 |

### User（ユーザー）

| 属性 | 説明 |
|------|------|
| ID | ユーザーの一意識別子 |
| GitHubユーザー名 | GitHubアカウントのユーザー名 |
| 表示名 | ダッシュボード上の表示名 |
| アバターURL | GitHubプロフィール画像 |
| 最終ログイン日時 | 最後にログインした日時 |

---

## 8. Success Criteria

- **SC-1**: ユーザーがGitHubアカウントでログインし、ダッシュボードにアクセスできる
- **SC-2**: GitHubリポジトリでIssueを作成すると、5秒以内にダッシュボードに表示される
- **SC-3**: GitHubリポジトリでPRをマージすると、5秒以内にダッシュボードに表示される
- **SC-4**: ダッシュボードを開いたまま、ページリロードなしで新着イベントが自動表示される
- **SC-5**: イベント種別でフィルタリングした結果が正しく表示される
- **SC-6**: 不正な署名を持つWebhookリクエストが拒否される
- **SC-7**: 未認証ユーザーがダッシュボードにアクセスできない
- **SC-8**: 単一コマンドで開発環境の全サービスが起動し、上記すべてが動作する

---

## 9. Scope Boundaries

### スコープ内

- Issue作成イベントの受信・表示
- PRマージイベントの受信・表示
- Webhook署名検証
- GitHub OAuthによるログイン認証
- イベント一覧表示（新しい順）
- イベント種別フィルタリング
- イベント詳細表示
- リアルタイム更新（サーバープッシュ）
- イベントデータの永続化
- コンテナ化された開発環境

### スコープ外

- Issue closed/edited、PR opened/closed/review 等の追加イベント
- 複数リポジトリの管理UI
- イベントの検索・集計・統計ウィジェット
- メール・チャットツール等への外部通知連携
- CI/CDパイプライン
- 本番環境へのデプロイ・クラウドインフラ
- パフォーマンスチューニング・負荷テスト
- ユーザー権限管理（ロールベースアクセス制御）

---

## 10. Dependencies & Assumptions

### Dependencies

- **GitHub Webhook**: GitHubがWebhookイベントを送信できること
- **GitHub OAuth App**: GitHub上でOAuthアプリケーションが登録されていること
- **ネットワーク**: ローカル環境からGitHub APIへのアクセスが可能であること（OAuth認証フロー用）

### Assumptions

- 本システムは技術検証（PoC）を主目的とするが、一般公開可能な品質で構築する
- 初期スコープでは単一リポジトリからのイベントのみを対象とする
- ユーザー数は少数（開発チーム規模：〜10名程度）を想定する
- イベントデータの保持期間に制限は設けない（PoC期間中のデータ量は問題にならない想定）
- GitHub Webhookの再送機能（配信失敗時のリトライ）はGitHub側に依存し、本システムでは再取得を行わない
- セッション有効期限は24時間をデフォルトとする

---

## 11. Risks

| リスク | 影響 | 軽減策 |
|--------|------|--------|
| ローカル環境でWebhookを受信できない | イベント受信のテストが困難 | ngrok等のトンネリングツールを利用してローカル環境を外部公開する |
| GitHub OAuthアプリの設定ミス | ログインが機能しない | 設定手順をドキュメント化し、環境変数で管理する |
| リアルタイム接続の切断 | 新着イベントが表示されない | 自動再接続機能を実装する |

---

## 12. Future Considerations

- 対象イベントの拡張（Issue closed/edited、PR opened/closed、Review、Push、Comment等）
- 複数リポジトリの同時監視
- イベントの検索・集計・統計ダッシュボード
- 外部通知連携（Slack、メール等）
- ユーザー権限管理（管理者/閲覧者等のロール）
- 本番環境へのデプロイ対応
